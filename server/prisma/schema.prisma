// Prisma schema for GSAPS backend
// Datasource configured for PostgreSQL

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id           Int              @id @default(autoincrement())
  email        String           @unique
  username     String           @unique
  passwordHash String
  name         String
  role         String           @default("member")
  bio          String?
  avatarUrl    String?
  credentials  String?
  verified     Boolean          @default(false)
  createdAt    DateTime         @default(now())
  posts        Post[]
  reactions    Reaction[]
  sentMessages Message[]        @relation("sentMessages")
  received     Message[]        @relation("receivedMessages")
  enrollments  Enrollment[]
  achievements Achievement[]
  assets       ResearchAsset[]
}

model Post {
  id        Int         @id @default(autoincrement())
  title     String?
  content   String
  tags      String[]
  author    User        @relation(fields: [authorId], references: [id])
  authorId  Int
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  reactions Reaction[]
}

model Reaction {
  id        Int      @id @default(autoincrement())
  type      String
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  post      Post     @relation(fields: [postId], references: [id])
  postId    Int
  createdAt DateTime @default(now())
}

model Message {
  id          Int      @id @default(autoincrement())
  body        String
  sender      User     @relation("sentMessages", fields: [senderId], references: [id])
  senderId    Int
  recipient   User     @relation("receivedMessages", fields: [recipientId], references: [id])
  recipientId Int
  createdAt   DateTime @default(now())
  read        Boolean  @default(false)
}

model Course {
  id          Int          @id @default(autoincrement())
  title       String
  description String
  category    String?
  level       String? @default("beginner")
  contentUrl  String?
  createdAt   DateTime     @default(now())
  enrollments Enrollment[]
}

model Enrollment {
  id        Int      @id @default(autoincrement())
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  course    Course   @relation(fields: [courseId], references: [id])
  courseId  Int
  status    String   @default("enrolled")
  progress  Int      @default(0)
  updatedAt DateTime @updatedAt

  @@unique([userId, courseId])
}

model Achievement {
  id        Int      @id @default(autoincrement())
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  type      String
  points    Int      @default(0)
  createdAt DateTime @default(now())
}

model ResearchAsset {
  id          Int      @id @default(autoincrement())
  title       String
  description String
  url         String
  type        String
  owner       User     @relation(fields: [ownerId], references: [id])
  ownerId     Int
  createdAt   DateTime @default(now())
}
